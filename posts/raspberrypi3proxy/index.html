<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="スマフォでhosts設定をする必要があって調べてみたのですが、スマフォ本体だけでやるとjail breakしたりroot化したりする必要がありそうでした。 そこまではしたくなかったので、proxyサーバを立て、そこにhosts設定することで、スマフォからも同様の事ができるようにしてみました。 何個か環境が必要だったので、お手軽に増やせるRaspberry Piを使用。 DNSサーバを立てることもしてみたのですが、通常のDNSへの切り替えが不安定だったためこちらは断念しました。
本体の用意 #  適当にAmazonで揃えました。
 本体  Amazon | Raspberry Pi 3 Model B   ケースなど  Amazon | 3 in 1 ! 耐用薄型 Raspberry Pi ３ 2 model B+ 専用高級ABSケース ＋冷却ファン＋アルミ・ヒートシンク4個   micro SDカード micro USBアダプタ  OSセットアップ #  わりと定番になっていそうなRaspbianにしました。 バージョンは最新のStretchを採用。
こちらの記事がとても丁寧に解説されていて参考になりました。 Raspberry Pi 3 初期セットアップ（Mac 用） - Qiita
 SDカードへの書き込み例  wget https://downloads.raspberrypi.org/raspbian_lite_latest unzip raspbian_lite_latest sudo diskutil eraseDisk FAT32 RPI /dev/disk2 df -h # SDのディスク名を取り出す 例: /dev/disk2s2 sudo diskutil unmountDisk /dev/disk2s2 sudo dd bs=1m if=2018-03-13-raspbian-stretch-lite."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Raspberry PiでProxyサーバを立てる（Raspbian Stretch）"><meta property="og:description" content="スマフォでhosts設定をする必要があって調べてみたのですが、スマフォ本体だけでやるとjail breakしたりroot化したりする必要がありそうでした。 そこまではしたくなかったので、proxyサーバを立て、そこにhosts設定することで、スマフォからも同様の事ができるようにしてみました。 何個か環境が必要だったので、お手軽に増やせるRaspberry Piを使用。 DNSサーバを立てることもしてみたのですが、通常のDNSへの切り替えが不安定だったためこちらは断念しました。
本体の用意 #  適当にAmazonで揃えました。
 本体  Amazon | Raspberry Pi 3 Model B   ケースなど  Amazon | 3 in 1 ! 耐用薄型 Raspberry Pi ３ 2 model B+ 専用高級ABSケース ＋冷却ファン＋アルミ・ヒートシンク4個   micro SDカード micro USBアダプタ  OSセットアップ #  わりと定番になっていそうなRaspbianにしました。 バージョンは最新のStretchを採用。
こちらの記事がとても丁寧に解説されていて参考になりました。 Raspberry Pi 3 初期セットアップ（Mac 用） - Qiita
 SDカードへの書き込み例  wget https://downloads.raspberrypi.org/raspbian_lite_latest unzip raspbian_lite_latest sudo diskutil eraseDisk FAT32 RPI /dev/disk2 df -h # SDのディスク名を取り出す 例: /dev/disk2s2 sudo diskutil unmountDisk /dev/disk2s2 sudo dd bs=1m if=2018-03-13-raspbian-stretch-lite."><meta property="og:type" content="article"><meta property="og:url" content="https://yfuku.com/posts/raspberrypi3proxy/"><meta property="article:published_time" content="2017-12-22T00:00:00+00:00"><meta property="article:modified_time" content="2017-12-22T00:00:00+00:00"><title>Raspberry PiでProxyサーバを立てる（Raspbian Stretch） | yfuku docs</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.c028b97c152dce71cd66d31c0ab323cd596d0f69d43b8e5def006e47b9d8809a.css integrity="sha256-wCi5fBUtznHNZtMcCrMjzVltD2nUO45d7wBuR7nYgJo="><script defer src=/en.search.min.56e6196b1dffd2a3d81e9bd99bc815658aef33c0f9af8e8b6c575ee840c3131b.js integrity="sha256-VuYZax3/0qPYHpvZm8gVZYrvM8D5r46LbFde6EDDExs="></script></head><body><input type=checkbox class=hidden id=menu-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>yfuku docs</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Keyboard</span><ul><li><span>Claw44</span><ul><li><a href=/docs/keyboard/claw44/whatis/>Claw44とは？</a></li><li><a href=/docs/keyboard/claw44/buildguide/>ビルドガイド</a></li></ul></li><li><span>bat43</span><ul><li><a href=/docs/keyboard/bat43/whatis/>bat43とは？</a></li><li><a href=/docs/keyboard/bat43/buildguide/>ビルドガイド</a></li></ul></li></ul></li><li class=book-section-flat><a href=/docs/example/>Example Site</a><ul><li><a href=/docs/example/table-of-contents/>Table of Contents</a><ul><li><a href=/docs/example/table-of-contents/with-toc/>With ToC</a></li><li><a href=/docs/example/table-of-contents/without-toc/>Without ToC</a></li></ul></li><li><a href=/docs/example/collapsed/ class=collapsed>Collapsed</a></li></ul></li><li class=book-section-flat><span>Shortcodes</span><ul><li><a href=/docs/shortcodes/buttons/>Buttons</a></li><li><a href=/docs/shortcodes/columns/>Columns</a></li><li><a href=/docs/shortcodes/details/>Details</a></li><li><a href=/docs/shortcodes/expand/>Expand</a></li><li><a href=/docs/shortcodes/hints/>Hints</a></li><li><a href=/docs/shortcodes/katex/>Katex</a></li><li><a href=/docs/shortcodes/mermaid/>Mermaid</a></li><li><a href=/docs/shortcodes/section/ class=collapsed>Section</a></li><li><a href=/docs/shortcodes/tabs/>Tabs</a></li></ul></li></ul><ul><li><a href=/posts/>Blog</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Raspberry PiでProxyサーバを立てる（Raspbian Stretch）</strong>
<label for=toc-control></label></div></header><article class=markdown><h1><a href=/posts/raspberrypi3proxy/>Raspberry PiでProxyサーバを立てる（Raspbian Stretch）</a></h1><h5>2017/12/22</h5><p><p>スマフォでhosts設定をする必要があって調べてみたのですが、スマフォ本体だけでやるとjail breakしたりroot化したりする必要がありそうでした。
そこまではしたくなかったので、proxyサーバを立て、そこにhosts設定することで、スマフォからも同様の事ができるようにしてみました。
何個か環境が必要だったので、お手軽に増やせるRaspberry Piを使用。
DNSサーバを立てることもしてみたのですが、通常のDNSへの切り替えが不安定だったためこちらは断念しました。</p><h1 id=本体の用意>本体の用意
<a class=anchor href=#%e6%9c%ac%e4%bd%93%e3%81%ae%e7%94%a8%e6%84%8f>#</a></h1><p>適当にAmazonで揃えました。</p><ul><li>本体<ul><li><a href=https://www.amazon.co.jp/o/ASIN/B01NAHBSUD/hoge0f-22/>Amazon | Raspberry Pi 3 Model B</a></li></ul></li><li>ケースなど<ul><li><a href=https://www.amazon.co.jp/o/ASIN/B01F6WBOCE/hoge0f-22/>Amazon | 3 in 1 ! 耐用薄型 Raspberry Pi ３ 2 model B+ 専用高級ABSケース ＋冷却ファン＋アルミ・ヒートシンク4個</a></li></ul></li><li>micro SDカード</li><li>micro USBアダプタ</li></ul><h1 id=osセットアップ>OSセットアップ
<a class=anchor href=#os%e3%82%bb%e3%83%83%e3%83%88%e3%82%a2%e3%83%83%e3%83%97>#</a></h1><p>わりと定番になっていそうなRaspbianにしました。
バージョンは最新のStretchを採用。</p><p>こちらの記事がとても丁寧に解説されていて参考になりました。
<a href=https://qiita.com/knyrc/items/d27cd0d8a78138de6b58>Raspberry Pi 3 初期セットアップ（Mac 用） - Qiita</a></p><ul><li>SDカードへの書き込み例</li></ul><pre><code>wget https://downloads.raspberrypi.org/raspbian_lite_latest

unzip raspbian_lite_latest

sudo diskutil eraseDisk FAT32 RPI /dev/disk2

df -h # SDのディスク名を取り出す 例: /dev/disk2s2

sudo diskutil unmountDisk /dev/disk2s2

sudo dd bs=1m if=2018-03-13-raspbian-stretch-lite.img of=/dev/rdisk2

sudo diskutil eject /dev/disk2s2
</code></pre><ul><li>補足<ul><li>こちらはstretchよりひとつ古いjessieになっているのでstretchに置き換えて実行しました。</li><li>初期ユーザはユーザ名：pi パスワードはraspberryと変わってしました。</li><li>wifiの設定はraspi-configで行うことができます</li><li>キーボードレイアウトは日本語(OADG 109A)にしました。<ul><li><a href=http://itengine.seesaa.net/article/445418538.html>Raspberry Pi 3のキーボードレイアウト変更: 文系エンジニアの私的ナレッジベース</a></li></ul></li></ul></li></ul><p>ここまででsshでRaspberry Piに入れるようになってると思います。</p><h2 id=ip固定化>IP固定化
<a class=anchor href=#ip%e5%9b%ba%e5%ae%9a%e5%8c%96>#</a></h2><p>Jessieからは、<code>/etc/dhcpcd.conf</code>を編集するようになったようです。Stretchでも同様です。</p><ul><li><a href=https://qiita.com/MarieKawasuji/items/b088ffb252a92eee8f5d>Raspberry Pi に固定IPアドレスを割り当てる方法（Raspbian Jessie） - Qiita</a></li></ul><h1 id=ソフトウェア>ソフトウェア
<a class=anchor href=#%e3%82%bd%e3%83%95%e3%83%88%e3%82%a6%e3%82%a7%e3%82%a2>#</a></h1><h2 id=squidのインストール>squidのインストール
<a class=anchor href=#squid%e3%81%ae%e3%82%a4%e3%83%b3%e3%82%b9%e3%83%88%e3%83%bc%e3%83%ab>#</a></h2><ul><li>squidのインストール</li></ul><pre><code>sudo apt-get update
sudo apt-get install squid
</code></pre><ul><li>/etc/squid/squid.confを編集</li></ul><pre><code># localnetのみアクセスを許可。下記をコメントアウト。
acl localnet src 192.168.0.0/16	# RFC1918 possible internal network
http_access allow localnet

# portは8888に書き換える。
http_port 8888

# キャッシュを無効にする。下記を最下部に追記。
acl NOCACHE src all
cache deny NOCACHE
</code></pre><ul><li>再起動</li></ul><pre><code>sudo service squid restart
</code></pre></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div></main></body></html>